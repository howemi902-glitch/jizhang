# iOS 记账应用开发方案

## 1. 产品定位与核心目标
- **目标用户**：有日常记账、预算管理需求的个人或家庭。
- **使用场景**：快速记录日常消费、跟踪收入、制定预算与财务目标。
- **核心诉求**：操作简洁、数据安全、可视化报表清晰。

## 2. 功能规划
### 2.1 MVP 功能
1. **账目管理**
   - 支出/收入快速录入：金额、分类、账户、标签、备注、日期时间。
   - 多币种支持（可先实现人民币与美元）。
   - 可编辑、删除账目。
2. **分类与预算**
   - 默认分类：餐饮、交通、购物、娱乐、居住、工资、理财等。
   - 自定义分类：用户可新增/编辑分类，支持图标或颜色标记。
   - 月度预算：设置分类预算并跟踪使用情况。
3. **数据统计**
   - 月度支出/收入汇总。
   - 分类饼图、趋势折线图。
   - 近期账目列表与搜索。
4. **同步与备份（MVP 可选）**
   - 本地 Core Data 持久化。
   - iCloud 同步作为迭代目标。

### 2.2 迭代功能
- 多账户管理（现金、银行卡、信用卡、电子钱包）。
- 预算提醒与推送通知。
- 债务与储蓄目标管理。
- 小组件与 Apple Watch 支持。
- OCR 识别发票/小票。
- AA 功能：基于历史数据的自动分析与智能建议。

## 3. 技术选型
- **框架**：SwiftUI + Combine（或 Observation），适配 iOS 16+。
- **数据层**：Core Data + CloudKit 同步（后续迭代）。
- **依赖管理**：Swift Package Manager。
- **架构模式**：MVVM。
- **图表库**：使用 Swift Charts（iOS 16+ 原生）或开源 Charts。
- **本地化**：中文为主，预留多语言扩展能力。

## 4. 系统架构
```
App (SwiftUI)
├── Modules
│   ├── Dashboard
│   ├── Transactions
│   ├── Budget
│   └── Settings
├── Core
│   ├── Data
│   │   ├── Models (Core Data + DTO)
│   │   ├── Repository
│   │   └── Persistence Controller
│   ├── Services
│   │   ├── CurrencyService
│   │   ├── CategoryService
│   │   ├── AnalyticsService
│   │   └── AARecommendationService
│   └── Common
│       ├── Extensions
│       └── Utilities
└── Resources
    ├── Localization
    └── Assets
```

### 4.1 数据模型草案
| 实体 | 关键字段 | 描述 |
| --- | --- | --- |
| `Transaction` | id, type, amount, currency, categoryId, accountId, note, tags, date | 收支记录 |
| `Category` | id, name, icon, color, type, budgetLimit | 收支分类 |
| `Account` | id, name, type, balance | 账户信息 |
| `Budget` | id, month, categoryId, amount, spent | 预算追踪 |
| `Tag` | id, name | 标签 |

### 4.2 模块职责
- **Dashboard**：展示总览数据与图表。
- **Transactions**：记录列表、搜索、过滤、详情、编辑。
- **Budget**：预算设置与执行情况。
- **Settings**：账户管理、分类管理、同步、数据导出等。

## 5. UI 设计草图
### 5.1 导航结构
- 使用 `TabView` 提供「总览」「流水」「预算」「设置」四个主标签页。
- 新增账目按钮使用浮动 `+` 按钮或工具栏按钮。

### 5.2 关键页面
1. **总览页**
   - 当月支出/收入概览卡片。
   - 分类饼图、趋势折线图。
   - 预算使用情况卡片。
2. **流水页**
   - 按日期分组的账目列表。
   - 顶部提供搜索与过滤。
   - 支持左右滑动快速删除/编辑。
3. **新增账目表单**
   - 金额输入（自定义键盘）。
   - 分类选择（网格）。
   - 日期、账户、标签、备注。
4. **预算页**
   - 分类预算卡片，显示预算/已用/剩余。
   - 可新增/编辑预算。
5. **设置页**
   - 账户与分类管理入口。
   - 数据导入导出、同步设置、个性化主题。

## 6. 开发计划
### 6.1 Sprint 1：基础框架
- 创建 Xcode 项目（SwiftUI、Core Data 模板）。
- 搭建数据模型与 PersistenceController。
- 搭建 TabView 结构与基础页面占位。

### 6.2 Sprint 2：账目录入与列表
- 实现新增/编辑/删除账目逻辑。
- 构建 `TransactionViewModel` 与列表 UI。
- 日期分组与搜索过滤。

### 6.3 Sprint 3：分类与预算
- 分类管理界面与数据层。
- 预算设置与超额提醒逻辑。
- 预算页面 UI。

### 6.4 Sprint 4：统计与可视化
- 集成 Swift Charts，构建分类饼图与趋势图。
- Dashboard 汇总数据与卡片 UI。
- 导出 CSV 功能（可选）。

### 6.5 后续迭代
- iCloud 同步。
- 多账户支持。
- 通知、Widget、Apple Watch。
- OCR 发票识别。
- AA 功能上线与效果验证。

## 11. AA 功能设计
### 11.1 功能目标
- 基于用户账目历史，自动分析消费趋势与异常波动。
- 为用户提供预算优化与节省建议，提高留存与粘性。

### 11.2 用户流程
1. 用户在 Dashboard 查看「AA 智能分析」卡片。
2. 系统每日离线计算更新推荐结果，展示摘要与趋势。
3. 用户可点击卡片进入详情页，查看详细建议与操作步骤。
4. 对建议进行「已采纳/忽略」反馈，帮助模型持续优化。

### 11.3 数据与算法
- 数据来源：过去 12 个月的 `Transaction`、`Budget` 与 `Account` 数据。
- 分析维度：消费分类偏差、预算执行率、周期性支出预测。
- 算法实现：
  - 使用本地统计模型（移动平均、同比环比）生成初版建议。
  - 结合规则引擎触发提醒，如「本月餐饮支出高于预算 20%」。
- 数据隐私：全部分析在本地完成，可选启用 iCloud 同步时上传摘要。

### 11.4 界面与交互
- Dashboard 卡片显示本周重点建议与状态标签（例如「超支预警」「优化建议」）。
- 详情页包含：
  - 图表展示趋势与对比数据。
  - 建议列表，附可操作按钮（调整预算、设置提醒、创建储蓄目标等）。
  - 反馈控件（👍 / 👎）与备注输入。

### 11.5 技术实现
- 新增 `AARecommendationService`，定时（如每日 App 启动或后台刷新时）计算建议。
- 持久化 `AARecommendation` 实体，字段包含 id、type、title、message、categoryId、createdAt、status。
- `AnalyticsService` 提供基础统计，AA 服务在其上构建规则与建议模板。
- 使用 BackgroundTasks 框架在后台刷新数据，保证体验流畅。
- 编写单元测试覆盖建议生成逻辑与边界情况（无数据、预算缺失等）。

### 11.6 风险与对策
| 风险 | 影响 | 应对策略 |
| --- | --- | --- |
| 建议准确性不足 | 降低用户信任 | 迭代算法、引入用户反馈权重 |
| 计算性能压力 | 影响启动速度 | 后台预计算、增量更新数据 |
| 数据隐私顾虑 | 用户拒绝开启 | 提供透明说明，可选择退出分析 |

## 7. 品质保障
- 单元测试：Core Data Repository、ViewModel 逻辑。
- UI 测试：关键操作流程（新增账目、修改、预算告警）。
- 性能与能耗：关注图表渲染与数据库查询。
- 无障碍支持：VoiceOver 标签、动态字体适配。

## 8. 上线与运营
- TestFlight 测试与收集反馈。
- App Store 截图、关键词优化。
- 用户引导与 FAQ 文档。
- 数据隐私政策与用户协议。

## 9. 风险与对策
| 风险 | 影响 | 应对策略 |
| --- | --- | --- |
| 数据安全与隐私 | 影响用户信任 | 使用系统加密、隐私声明、离线模式 |
| 同步冲突 | 数据不一致 | 引入时间戳与版本控制，冲突合并策略 |
| 用户留存 | 使用频率低 | 提供预算提醒、数据分析洞察、每日摘要 |
| 开发周期 | 项目延期 | 采用敏捷迭代，定期评审与优先级调整 |

## 10. 下一步
1. 创建 SwiftUI + Core Data 项目骨架。
2. 定义 Core Data 模型并生成实体类。
3. 搭建基础页面框架与导航。
4. 完成账目录入表单设计稿与原型。

## 12. 下载与安装指引
### 12.1 内测阶段（TestFlight）
1. 在 App Store Connect 创建 TestFlight 构建并添加测试描述。
2. 邀请核心用户或团队成员加入 TestFlight 测试群组。
3. 提供下载链接或二维码，引导测试用户安装 TestFlight 并接受邀请。
4. 收集崩溃日志与问卷反馈，快速迭代修复问题。

### 12.2 正式版发布（App Store）
1. 准备 App Store 截图、关键字、隐私政策链接与营销文案。
2. 在 App Store Connect 提交审核包，并填写「联系信息」「版权」「审核备注」。
3. 审核通过后发布上线，生成公开的 App Store 下载链接。
4. 在官网、社交媒体与应用内公告中同步下载方式与更新说明。

### 12.3 企业内部分发（可选）
- 若需在企业或小范围内部署，可使用 Apple Business Manager 或 Ad Hoc 分发。
- 提供安装描述文件并指导用户在「设置 > 通用 > VPN 与设备管理」中信任证书。
- 定期更新构建并通知用户重新下载安装，确保证书不过期。

